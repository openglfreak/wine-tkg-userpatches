From: Paul Gofman <pgofman@codeweavers.com>
Subject: [PATCH 3/7] ws2_32: Treat optlen as unsigned in setsockopt() for SO_SNDTIMEO.
Message-Id: <20220305190409.343255-3-pgofman@codeweavers.com>
Date: Sat,  5 Mar 2022 22:04:05 +0300
In-Reply-To: <20220305190409.343255-1-pgofman@codeweavers.com>
References: <20220305190409.343255-1-pgofman@codeweavers.com>

Signed-off-by: Paul Gofman <pgofman@codeweavers.com>
---
 dlls/ws2_32/socket.c | 1 +
 1 file changed, 1 insertion(+)

diff --git a/dlls/ws2_32/socket.c b/dlls/ws2_32/socket.c
index 2e99f415c72..efc0a5b488a 100644
--- a/dlls/ws2_32/socket.c
+++ b/dlls/ws2_32/socket.c
@@ -2837,6 +2837,7 @@ int WINAPI setsockopt( SOCKET s, int level, int optname, const char *optval, int
             return server_setsockopt( s, IOCTL_AFD_WINE_SET_SO_SNDBUF, optval, optlen );
 
         case SO_SNDTIMEO:
+            if (optlen < 0) optlen = 4;
             return server_setsockopt( s, IOCTL_AFD_WINE_SET_SO_SNDTIMEO, optval, optlen );
 
         /* SO_DEBUG is a privileged operation, ignore it. */

-- 
2.35.1


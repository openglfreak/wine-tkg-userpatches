From 6155b5dc7169d06d1300412ca6300cad9f10f3ff Mon Sep 17 00:00:00 2001
From: =?UTF-8?q?R=C3=A9mi=20Bernon?= <rbernon@codeweavers.com>
Date: Mon, 18 Jan 2021 19:21:09 +0100
Subject: [PATCH 17/26] server: Remove cursor and show_count from
 get_thread_input.

---
 include/wine/server_protocol.h | 6 ++----
 server/protocol.def            | 2 --
 server/queue.c                 | 2 --
 server/request.h               | 6 ++----
 server/trace.c                 | 2 --
 5 files changed, 4 insertions(+), 14 deletions(-)

diff --git a/include/wine/server_protocol.h b/include/wine/server_protocol.h
index 9e898968dc6..f559adee841 100644
--- a/include/wine/server_protocol.h
+++ b/include/wine/server_protocol.h
@@ -4129,10 +4129,8 @@ struct get_thread_input_reply
     user_handle_t  menu_owner;
     user_handle_t  move_size;
     user_handle_t  caret;
-    user_handle_t  cursor;
-    int            show_count;
     rectangle_t    rect;
-    char __pad_60[4];
+    char __pad_52[4];
 };
 
 
@@ -6784,7 +6782,7 @@ union generic_reply
 
 /* ### protocol_version begin ### */
 
-#define SERVER_PROTOCOL_VERSION 702
+#define SERVER_PROTOCOL_VERSION 703
 
 /* ### protocol_version end ### */
 
diff --git a/server/protocol.def b/server/protocol.def
index fbfdf25b2de..7edca5253b0 100644
--- a/server/protocol.def
+++ b/server/protocol.def
@@ -2946,8 +2946,6 @@ enum coords_relative
     user_handle_t  menu_owner;    /* handle to the menu owner */
     user_handle_t  move_size;     /* handle to the moving/resizing window */
     user_handle_t  caret;         /* handle to the caret window */
-    user_handle_t  cursor;        /* handle to the cursor */
-    int            show_count;    /* cursor show count */
     rectangle_t    rect;          /* caret rectangle */
 @END
 
diff --git a/server/queue.c b/server/queue.c
index e47db3b0407..48a8b7639ab 100644
--- a/server/queue.c
+++ b/server/queue.c
@@ -3205,8 +3205,6 @@ DECL_HANDLER(get_thread_input)
         reply->menu_owner = input->shared->menu_owner;
         reply->move_size  = input->shared->move_size;
         reply->caret      = input->shared->caret;
-        reply->cursor     = input->shared->cursor;
-        reply->show_count = input->shared->cursor_count;
         reply->rect       = input->shared->caret_rect;
     }
 
diff --git a/server/request.h b/server/request.h
index 38741ca778e..425a9d93d1b 100644
--- a/server/request.h
+++ b/server/request.h
@@ -1865,10 +1865,8 @@ C_ASSERT( FIELD_OFFSET(struct get_thread_input_reply, foreground) == 20 );
 C_ASSERT( FIELD_OFFSET(struct get_thread_input_reply, menu_owner) == 24 );
 C_ASSERT( FIELD_OFFSET(struct get_thread_input_reply, move_size) == 28 );
 C_ASSERT( FIELD_OFFSET(struct get_thread_input_reply, caret) == 32 );
-C_ASSERT( FIELD_OFFSET(struct get_thread_input_reply, cursor) == 36 );
-C_ASSERT( FIELD_OFFSET(struct get_thread_input_reply, show_count) == 40 );
-C_ASSERT( FIELD_OFFSET(struct get_thread_input_reply, rect) == 44 );
-C_ASSERT( sizeof(struct get_thread_input_reply) == 64 );
+C_ASSERT( FIELD_OFFSET(struct get_thread_input_reply, rect) == 36 );
+C_ASSERT( sizeof(struct get_thread_input_reply) == 56 );
 C_ASSERT( sizeof(struct get_last_input_time_request) == 16 );
 C_ASSERT( FIELD_OFFSET(struct get_last_input_time_reply, time) == 8 );
 C_ASSERT( sizeof(struct get_last_input_time_reply) == 16 );
diff --git a/server/trace.c b/server/trace.c
index 6e2840f62e5..945ced51bdb 100644
--- a/server/trace.c
+++ b/server/trace.c
@@ -3511,8 +3511,6 @@ static void dump_get_thread_input_reply( const struct get_thread_input_reply *re
     fprintf( stderr, ", menu_owner=%08x", req->menu_owner );
     fprintf( stderr, ", move_size=%08x", req->move_size );
     fprintf( stderr, ", caret=%08x", req->caret );
-    fprintf( stderr, ", cursor=%08x", req->cursor );
-    fprintf( stderr, ", show_count=%d", req->show_count );
     dump_rectangle( ", rect=", &req->rect );
 }
 


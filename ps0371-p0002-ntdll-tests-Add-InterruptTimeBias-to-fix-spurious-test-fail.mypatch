From 60934b6014268a9ef30e2089c62e00d3de447eee Mon Sep 17 00:00:00 2001
From: =?UTF-8?q?R=C3=A9mi=20Bernon?= <rbernon@codeweavers.com>
Date: Wed, 10 Mar 2021 11:32:10 +0100
Subject: [PATCH 02/14] ntdll/tests: Add InterruptTimeBias to fix spurious test
 failures.

---
 dlls/ntdll/tests/time.c | 5 ++---
 1 file changed, 2 insertions(+), 3 deletions(-)

diff --git a/dlls/ntdll/tests/time.c b/dlls/ntdll/tests/time.c
index 931bf765aa7..51d9115b87c 100644
--- a/dlls/ntdll/tests/time.c
+++ b/dlls/ntdll/tests/time.c
@@ -243,14 +243,13 @@ static void test_user_shared_data_time(void)
         do
         {
             pRtlQueryUnbiasedInterruptTime(&t1);
-            t2 = read_ksystem_time(&user_shared_data->InterruptTime);
+            t2 = read_ksystem_time(&user_shared_data->InterruptTime) - user_shared_data->InterruptTimeBias;
             pRtlQueryUnbiasedInterruptTime(&t3);
         } while(t3 < t1 && i++ < 1); /* allow for wrap, but only once */
 
         ok(t1 <= t2, "USD InterruptTime / RtlQueryUnbiasedInterruptTime are out of order %s %s\n",
            wine_dbgstr_longlong(t1), wine_dbgstr_longlong(t2));
-        ok(t2 <= t3 || broken(t2 == t3 + 82410089070) /* w864 has some weird offset on testbot */,
-           "USD InterruptTime / RtlQueryUnbiasedInterruptTime are out of order %s %s\n",
+        ok(t2 <= t3, "USD InterruptTime / RtlQueryUnbiasedInterruptTime are out of order %s %s\n",
            wine_dbgstr_longlong(t2), wine_dbgstr_longlong(t3));
     }
 }
-- 
2.30.2


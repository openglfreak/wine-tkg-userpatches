From: Paul Gofman <pgofman@codeweavers.com>
Subject: [PATCH 2/7] ws2_32: Treat optlen as unsigned in setsockopt() for SO_RCVTIMEO.
Message-Id: <20220305190409.343255-2-pgofman@codeweavers.com>
Date: Sat,  5 Mar 2022 22:04:04 +0300
In-Reply-To: <20220305190409.343255-1-pgofman@codeweavers.com>
References: <20220305190409.343255-1-pgofman@codeweavers.com>

Signed-off-by: Paul Gofman <pgofman@codeweavers.com>
---
 dlls/ws2_32/socket.c | 1 +
 1 file changed, 1 insertion(+)

diff --git a/dlls/ws2_32/socket.c b/dlls/ws2_32/socket.c
index 30dc007167a..2e99f415c72 100644
--- a/dlls/ws2_32/socket.c
+++ b/dlls/ws2_32/socket.c
@@ -2827,6 +2827,7 @@ int WINAPI setsockopt( SOCKET s, int level, int optname, const char *optval, int
             return server_setsockopt( s, IOCTL_AFD_WINE_SET_SO_RCVBUF, optval, optlen );
 
         case SO_RCVTIMEO:
+            if (optlen < 0) optlen = 4;
             return server_setsockopt( s, IOCTL_AFD_WINE_SET_SO_RCVTIMEO, optval, optlen );
 
         case SO_REUSEADDR:

-- 
2.35.1


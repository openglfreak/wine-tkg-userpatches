From: Daniel Lehman <dlehman@esri.com>
#Subject: [PATCH v2 2/2] msxml3: Make utf-8 the default encoding.
Message-Id: <CO6PR05MB75061985358E991211C3D490DF5F9@CO6PR05MB7506.namprd05.prod.outlook.com>
Date: Tue, 25 Jan 2022 17:52:41 +0000


From afcdebe834c192fe297d03098d336995e23c00ae Mon Sep 17 00:00:00 2001
From: Daniel Lehman <dlehman@esri.com>
Date: Wed, 24 Nov 2021 08:33:06 -0800
Subject: [PATCH v2 2/2] msxml3: Make utf-8 the default encoding.

Signed-off-by: Daniel Lehman <dlehman@esri.com>
---
 dlls/msxml3/domdoc.c       | 3 +++
 dlls/msxml3/tests/domdoc.c | 2 +-
 2 files changed, 4 insertions(+), 1 deletion(-)

diff --git a/dlls/msxml3/domdoc.c b/dlls/msxml3/domdoc.c
index 2ba850c7b29..5e8407a8dcb 100644
--- a/dlls/msxml3/domdoc.c
+++ b/dlls/msxml3/domdoc.c
@@ -2627,6 +2627,9 @@ static char *xmldoc_encoding(IXMLDOMDocument3 *doc)
         IXMLDOMNode_Release(node);
     }
 
+    if (!encoding && (encoding = heap_alloc(sizeof("UTF-8"))))
+        strcpy(encoding, "UTF-8");
+
     return encoding;
 }
 
diff --git a/dlls/msxml3/tests/domdoc.c b/dlls/msxml3/tests/domdoc.c
index fdb154900f4..60a0486cd71 100644
--- a/dlls/msxml3/tests/domdoc.c
+++ b/dlls/msxml3/tests/domdoc.c
@@ -6636,7 +6636,7 @@ static void test_save(void)
     {
        ReadFile(hfile, buffer, sizeof(buffer), &read, NULL);
        ok(read != 0, "could not read file\n");
-       todo_wine ok(!memcmp(buffer, cheA, sizeof(cheA)-1), "got: %s\n", buffer);
+       ok(!memcmp(buffer, cheA, sizeof(cheA)-1), "got: %s\n", buffer);
 
        CloseHandle(hfile);
        DeleteFileA("test.xml");

-- 
2.35.1


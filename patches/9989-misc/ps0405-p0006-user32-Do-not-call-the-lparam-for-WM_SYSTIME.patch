From: Zebediah Figura <zfigura@codeweavers.com>
Subject: [PATCH v2 6/6] user32: Do not call the lparam for WM_SYSTIMER messages.
Message-Id: <20220415182828.3116131-6-zfigura@codeweavers.com>
Date: Fri, 15 Apr 2022 13:28:28 -0500
In-Reply-To: <20220415182828.3116131-1-zfigura@codeweavers.com>
References: <20220415182828.3116131-1-zfigura@codeweavers.com>

Signed-off-by: Zebediah Figura <zfigura@codeweavers.com>
---
 dlls/user32/message.c | 23 ++++++++++-------------
 1 file changed, 10 insertions(+), 13 deletions(-)

diff --git a/dlls/user32/message.c b/dlls/user32/message.c
index 11111111111..11111111111 100644
--- a/dlls/user32/message.c
+++ b/dlls/user32/message.c
@@ -861,22 +861,19 @@ LRESULT WINAPI DECLSPEC_HOTPATCH DispatchMessageA( const MSG* msg )
     LRESULT retval;
 
       /* Process timer messages */
-    if ((msg->message == WM_TIMER) || (msg->message == WM_SYSTIMER))
+    if (msg->lParam && msg->message == WM_TIMER)
     {
-        if (msg->lParam)
+        __TRY
         {
-            __TRY
-            {
-                retval = CallWindowProcA( (WNDPROC)msg->lParam, msg->hwnd,
-                                          msg->message, msg->wParam, GetTickCount() );
-            }
-            __EXCEPT_ALL
-            {
-                retval = 0;
-            }
-            __ENDTRY
-            return retval;
+            retval = CallWindowProcA( (WNDPROC)msg->lParam, msg->hwnd,
+                                      msg->message, msg->wParam, GetTickCount() );
+        }
+        __EXCEPT_ALL
+        {
+            retval = 0;
         }
+        __ENDTRY
+        return retval;
     }
     return NtUserDispatchMessageA( msg );
 }

-- 
2.35.3


From 32f7d25fd12b6e7a36caa976f4b36805a8f7c9c5 Mon Sep 17 00:00:00 2001
From: =?UTF-8?q?R=C3=A9mi=20Bernon?= <rbernon@codeweavers.com>
Date: Sun, 18 Apr 2021 14:03:04 +0200
Subject: [PATCH 06/13] user32/tests: Remove todo_wine for nulldrv.

---
 dlls/user32/tests/monitor.c   |  4 ----
 dlls/user32/tests/msg.c       | 12 ++++++------
 dlls/user32/tests/sysparams.c |  5 +----
 dlls/user32/tests/win.c       |  9 +++------
 4 files changed, 10 insertions(+), 20 deletions(-)

diff --git a/dlls/user32/tests/monitor.c b/dlls/user32/tests/monitor.c
index 11111111111..11111111111 100644
--- a/dlls/user32/tests/monitor.c
+++ b/dlls/user32/tests/monitor.c
@@ -238,7 +238,6 @@ static void test_EnumDisplaySettings(void)
     SetLastError( 0xdeadbeef );
     ret = EnumDisplaySettingsExW( adapter.DeviceName, ENUM_REGISTRY_SETTINGS, &devmode, 0 );
     ok( ret, "EnumDisplaySettingsExW failed, error %lu\n", GetLastError() );
-    todo_wine
     ok( GetLastError() == 0xdeadbeef, "EnumDisplaySettingsExW set last error %lu\n", GetLastError() );
 
     SetLastError( 0xdeadbeef );
@@ -544,7 +543,6 @@ static void test_ChangeDisplaySettingsEx(void)
         SetLastError(0xdeadbeef);
         res = ChangeDisplaySettingsExA(devices[0].name, &dm, NULL, CDS_UPDATEREGISTRY | CDS_NORESET, NULL);
         ok(res == DISP_CHANGE_SUCCESSFUL, "ChangeDisplaySettingsExA %s returned unexpected %ld\n", devices[0].name, res);
-        todo_wine
         ok(GetLastError() == 0xdeadbeef, "ChangeDisplaySettingsExA set last error %lu\n", GetLastError());
         res = ChangeDisplaySettingsExA(NULL, NULL, NULL, 0, NULL);
         ok(res == DISP_CHANGE_SUCCESSFUL ||
@@ -564,7 +562,6 @@ static void test_ChangeDisplaySettingsEx(void)
         SetLastError(0xdeadbeef);
         res = ChangeDisplaySettingsExA(devices[0].name, &devices[0].original_mode, NULL,
                 CDS_UPDATEREGISTRY | CDS_NORESET, NULL);
-        todo_wine
         ok(GetLastError() == 0xdeadbeef, "ChangeDisplaySettingsExA set last error %lu\n", GetLastError());
         ok(res == DISP_CHANGE_SUCCESSFUL ||
                 broken(res == DISP_CHANGE_BADPARAM) || /* win10 */
@@ -588,7 +585,6 @@ static void test_ChangeDisplaySettingsEx(void)
         SetLastError(0xdeadbeef);
         res = ChangeDisplaySettingsExA(devices[1].name, &dm, NULL, CDS_UPDATEREGISTRY | CDS_NORESET, NULL);
         ok(res == DISP_CHANGE_SUCCESSFUL, "ChangeDisplaySettingsExA %s returned unexpected %ld\n", devices[1].name, res);
-        todo_wine
         ok(GetLastError() == 0xdeadbeef, "ChangeDisplaySettingsExA set last error %lu\n", GetLastError());
         res = ChangeDisplaySettingsExA(devices[1].name, NULL, NULL, 0, NULL);
         ok(res == DISP_CHANGE_SUCCESSFUL, "ChangeDisplaySettingsExA %s returned unexpected %ld\n", devices[1].name, res);
diff --git a/dlls/user32/tests/msg.c b/dlls/user32/tests/msg.c
index 11111111111..11111111111 100644
--- a/dlls/user32/tests/msg.c
+++ b/dlls/user32/tests/msg.c
@@ -5591,14 +5591,14 @@ static void test_messages(void)
 
     ShowWindow(hwnd, SW_SHOWMAXIMIZED);
     flush_events();
-    ok_sequence(WmShowMaxOverlappedSeq, "ShowWindow(SW_SHOWMAXIMIZED):overlapped", TRUE);
+    ok_sequence(WmShowMaxOverlappedSeq, "ShowWindow(SW_SHOWMAXIMIZED):overlapped", FALSE);
     flush_sequence();
 
     if (GetWindowLongW( hwnd, GWL_STYLE ) & WS_MAXIMIZE)
     {
         ShowWindow(hwnd, SW_RESTORE);
         flush_events();
-        ok_sequence(WmShowRestoreMaxOverlappedSeq, "ShowWindow(SW_RESTORE):overlapped", TRUE);
+        ok_sequence(WmShowRestoreMaxOverlappedSeq, "ShowWindow(SW_RESTORE):overlapped", FALSE);
         flush_sequence();
     }
 
@@ -9815,7 +9815,7 @@ static void test_accelerators(void)
     keybd_event(VK_MENU, 0, KEYEVENTF_KEYUP, 0);
     pump_msg_loop(hwnd, 0);
     /* this test doesn't pass in Wine for managed windows */
-    ok_sequence(WmAltPressRelease, "Alt press/release", TRUE);
+    ok_sequence(WmAltPressRelease, "Alt press/release", FALSE);
 
     trace("testing VK_F1 press/release\n");
     keybd_event(VK_F1, 0, 0, 0);
@@ -9835,7 +9835,7 @@ static void test_accelerators(void)
     keybd_event(VK_F10, 0, 0, 0);
     keybd_event(VK_F10, 0, KEYEVENTF_KEYUP, 0);
     pump_msg_loop(hwnd, 0);
-    ok_sequence(WmVkF10Seq, "VK_F10 press/release", TRUE);
+    ok_sequence(WmVkF10Seq, "VK_F10 press/release", FALSE);
 
     trace("testing SHIFT+F10 press/release\n");
     keybd_event(VK_SHIFT, 0, 0, 0);
@@ -9845,7 +9845,7 @@ static void test_accelerators(void)
     keybd_event(VK_ESCAPE, 0, 0, 0);
     keybd_event(VK_ESCAPE, 0, KEYEVENTF_KEYUP, 0);
     pump_msg_loop(hwnd, 0);
-    ok_sequence(WmShiftF10Seq, "SHIFT+F10 press/release", TRUE);
+    ok_sequence(WmShiftF10Seq, "SHIFT+F10 press/release", FALSE);
 
     trace("testing Shift+MouseButton press/release\n");
     /* first, move mouse pointer inside of the window client area */
@@ -16260,7 +16260,7 @@ static DWORD CALLBACK post_rbuttonup_msg( void *arg )
     DWORD ret;
 
     ret = WaitForSingleObject( data->wndproc_finished, 500 );
-    todo_wine ok( ret == WAIT_OBJECT_0, "WaitForSingleObject returned %lx\n", ret );
+    ok( ret == WAIT_OBJECT_0, "WaitForSingleObject returned %lx\n", ret );
     if( ret == WAIT_OBJECT_0 ) return 0;
 
     PostMessageA( data->hwnd, WM_RBUTTONUP, 0, 0 );
diff --git a/dlls/user32/tests/sysparams.c b/dlls/user32/tests/sysparams.c
index 11111111111..11111111111 100644
--- a/dlls/user32/tests/sysparams.c
+++ b/dlls/user32/tests/sysparams.c
@@ -2497,9 +2497,7 @@ static void test_WM_DISPLAYCHANGE(void)
             continue;
         }
 
-        todo_wine_if(start_bpp != test_bpps[i]) {
-            ok(last_bpp == test_bpps[i], "Set bpp %d, but WM_DISPLAYCHANGE reported bpp %d\n", test_bpps[i], last_bpp);
-        }
+        ok(last_bpp == test_bpps[i], "Set bpp %d, but WM_DISPLAYCHANGE reported bpp %d\n", test_bpps[i], last_bpp);
         last_set_bpp = test_bpps[i];
     }
 
@@ -3562,7 +3560,6 @@ static void test_dpi_mapping(void)
             hdc = GetWindowDC( hwnd );
             GetClipBox( hdc, &rect );
             SetRect( &expect, 0, 0, 295, 303 );
-            todo_wine
             ok( EqualRect( &expect, &rect ), "%Iu/%Iu: wrong clip box win DC %s expected %s\n",
                 i, j, wine_dbgstr_rect(&rect), wine_dbgstr_rect(&expect) );
             ReleaseDC( hwnd, hdc );
diff --git a/dlls/user32/tests/win.c b/dlls/user32/tests/win.c
index 11111111111..11111111111 100644
--- a/dlls/user32/tests/win.c
+++ b/dlls/user32/tests/win.c
@@ -3281,7 +3281,7 @@ static void test_SetWindowPos(HWND hwnd, HWND hwnd2)
     ret = SetWindowPos(hwnd_child, NULL, 0, 0, 0, 0, SWP_NOSIZE|SWP_NOMOVE|SWP_NOACTIVATE|SWP_SHOWWINDOW);
     ok(ret, "Got %d\n", ret);
     flush_events( TRUE );
-    todo_wine check_active_state(hwnd2, hwnd2, hwnd2);
+    check_active_state(hwnd2, hwnd2, hwnd2);
     DestroyWindow(hwnd_child);
 }
 
@@ -4031,11 +4031,8 @@ static void test_SetForegroundWindow(HWND hwnd)
     while (PeekMessageA(&msg, 0, 0, 0, PM_REMOVE)) DispatchMessageA(&msg);
     if (0) check_wnd_state(hwnd2, hwnd2, hwnd2, 0);
 
-    /* FIXME: these tests are failing because of a race condition
-     * between internal focus state applied immediately and X11 focus
-     * message coming late */
-    todo_wine ok(GetActiveWindow() == hwnd2, "Expected active window %p, got %p.\n", hwnd2, GetActiveWindow());
-    todo_wine ok(GetFocus() == hwnd2, "Expected focus window %p, got %p.\n", hwnd2, GetFocus());
+    ok(GetActiveWindow() == hwnd2, "Expected active window %p, got %p.\n", hwnd2, GetActiveWindow());
+    ok(GetFocus() == hwnd2, "Expected focus window %p, got %p.\n", hwnd2, GetFocus());
 
     SetForegroundWindow(hwnd);
     check_wnd_state(hwnd, hwnd, hwnd, 0);
-- 
2.36.0


From: Jefferson Carpenter <jeffersoncarpenter2@gmail.com>
#Subject: [PATCH] msxml3: Fold in reset_output_buffer.
Message-Id: <9ff03425-2cdc-42b4-d746-091e229d67da@gmail.com>
Date: Tue, 2 Feb 2021 17:02:16 +0000

From eee7e83102c1d3ca20ff37e2943520f70358fe50 Mon Sep 17 00:00:00 2001
From: Jefferson Carpenter <jeffersoncarpenter2@gmail.com>
Date: Tue, 2 Feb 2021 19:01:10 +0000
Subject: [PATCH] msxml3: Fold in reset_output_buffer.

Signed-off-by: Jefferson Carpenter <jeffersoncarpenter2@gmail.com>
---
 dlls/msxml3/mxwriter.c | 16 ++++------------
 1 file changed, 4 insertions(+), 12 deletions(-)

diff --git a/dlls/msxml3/mxwriter.c b/dlls/msxml3/mxwriter.c
index 029e9aac0d0..ac3c0fa59c3 100644
--- a/dlls/msxml3/mxwriter.c
+++ b/dlls/msxml3/mxwriter.c
@@ -704,14 +704,6 @@ static inline HRESULT flush_output_buffer(mxwriter *This)
     return write_data_to_stream(This);
 }
 
-/* Resets the mxwriter's output buffer by closing it, then creating a new
- * output buffer using the given encoding.
- */
-static inline void reset_output_buffer(mxwriter *This)
-{
-    close_output_buffer(This);
-}
-
 static HRESULT writer_set_property(mxwriter *writer, mxwriter_prop property, VARIANT_BOOL value)
 {
     writer->props[property] = value;
@@ -972,7 +964,7 @@ static HRESULT WINAPI mxwriter_put_output(IMXWriter *iface, VARIANT dest)
         This->dest = NULL;
         This->dest_doc = NULL;
 
-        reset_output_buffer(This);
+        close_output_buffer(This);
         This->output_ty = OutputString;
         break;
     }
@@ -984,7 +976,7 @@ static HRESULT WINAPI mxwriter_put_output(IMXWriter *iface, VARIANT dest)
         if (hr == S_OK)
         {
             /* Recreate the output buffer to make sure it's using the correct encoding. */
-            reset_output_buffer(This);
+            close_output_buffer(This);
 
             if (This->dest) IStream_Release(This->dest);
             while (!FAILED(pop_cur_node(This)));
@@ -1006,7 +998,7 @@ static HRESULT WINAPI mxwriter_put_output(IMXWriter *iface, VARIANT dest)
         hr = IDispatch_QueryInterface(V_DISPATCH(&dest), &IID_IXMLDOMDocument, (void**)&document);
         if (hr == S_OK) {
             /* Reset output buffer to initial state. */
-            reset_output_buffer(This);
+            close_output_buffer(This);
 
             if (This->dest) IStream_Release(This->dest);
             while (!FAILED(pop_cur_node(This)));
@@ -1107,7 +1099,7 @@ static HRESULT WINAPI mxwriter_put_encoding(IMXWriter *iface, BSTR encoding)
     This->xml_enc = enc;
 
     TRACE("got encoding %d\n", This->xml_enc);
-    reset_output_buffer(This);
+    close_output_buffer(This);
     return S_OK;
 }
 
@@ -1312,7 +1304,7 @@ static HRESULT WINAPI SAXContentHandler_startDocument(ISAXContentHandler *iface)
          * be how Windows works.
          */
         if (This->prop_changed) {
-            reset_output_buffer(This);
+            close_output_buffer(This);
             This->prop_changed = FALSE;
         }
 

-- 
2.26.2


From 24ea6dc4e4bc6fc960b9365779853c98f41ce610 Mon Sep 17 00:00:00 2001
From: Zebediah Figura <z.figura12@gmail.com>
Date: Tue, 6 Apr 2021 15:36:22 -0500
Subject: [PATCH 24/28] server: Add a request to check whether there are any
 queued user APCs.

---
 server/protocol.def | 5 +++++
 server/queue.c      | 5 +++++
 2 files changed, 10 insertions(+)

diff --git a/server/protocol.def b/server/protocol.def
index 0b465c0df91..81e840168f3 100644
--- a/server/protocol.def
+++ b/server/protocol.def
@@ -3886,3 +3886,8 @@ enum fast_sync_type
     obj_handle_t handle;          /* handle to the queue */
     int          signaled;        /* was the queue signaled? */
 @END
+
+
+/* Check if there are any user APCs queued */
+@REQ(check_user_apc)
+@END
diff --git a/server/queue.c b/server/queue.c
index d507cb81bd7..1d3a1f4ecfd 100644
--- a/server/queue.c
+++ b/server/queue.c
@@ -3714,3 +3714,8 @@ DECL_HANDLER(fast_unselect_queue)
 
     release_object( queue );
 }
+
+DECL_HANDLER(check_user_apc)
+{
+    if (list_empty( &current->user_apc )) set_error( STATUS_TIMEOUT );
+}
-- 
2.31.1


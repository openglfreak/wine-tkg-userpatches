From: Brendan Shanks <bshanks@codeweavers.com>
Subject: [PATCH] kernelbase: Add RaiseFailFastException stub.
Message-Id: <20211020172403.32793-1-bshanks@codeweavers.com>
Date: Wed, 20 Oct 2021 10:24:03 -0700

Signed-off-by: Brendan Shanks <bshanks@codeweavers.com>
---

Fixes Essential Objects EO.WebBrowser, used by Quicken.

 dlls/kernel32/kernel32.spec     | 2 +-
 dlls/kernelbase/debug.c         | 8 ++++++++
 dlls/kernelbase/kernelbase.spec | 2 +-
 3 files changed, 10 insertions(+), 2 deletions(-)

diff --git a/dlls/kernel32/kernel32.spec b/dlls/kernel32/kernel32.spec
index 626fb173cf0..818c4f76eaf 100644
--- a/dlls/kernel32/kernel32.spec
+++ b/dlls/kernel32/kernel32.spec
@@ -1204,7 +1204,7 @@
 @ stdcall -import QueueUserAPC(ptr long long)
 @ stdcall -import QueueUserWorkItem(ptr ptr long)
 @ stdcall -import RaiseException(long long long ptr)
-# @ stub RaiseFailFastException
+@ stdcall -import RaiseFailFastException(ptr ptr long)
 @ stdcall -import ReadConsoleA(long ptr long ptr ptr)
 @ stdcall -import ReadConsoleInputA(long ptr long ptr)
 @ stub ReadConsoleInputExA
diff --git a/dlls/kernelbase/debug.c b/dlls/kernelbase/debug.c
index 9a37fd2e933..4b5901067c4 100644
--- a/dlls/kernelbase/debug.c
+++ b/dlls/kernelbase/debug.c
@@ -320,6 +320,14 @@ void WINAPI DECLSPEC_HOTPATCH RaiseException( DWORD code, DWORD flags, DWORD cou
 }
 __ASM_STDCALL_IMPORT(RaiseException,16)
 
+/*******************************************************************
+ *           RaiseFailFastException  (kernelbase.@)
+ */
+void WINAPI DECLSPEC_HOTPATCH RaiseFailFastException( EXCEPTION_RECORD *record, CONTEXT *context, DWORD flags )
+{
+    FIXME( "(%p, %p, %d) stub\n", record, context, flags );
+    TerminateProcess( GetCurrentProcess(), STATUS_FAIL_FAST_EXCEPTION );
+}
 
 /***********************************************************************
  *           SetUnhandledExceptionFilter   (kernelbase.@)
diff --git a/dlls/kernelbase/kernelbase.spec b/dlls/kernelbase/kernelbase.spec
index f65c3415b28..29f517ed5a9 100644
--- a/dlls/kernelbase/kernelbase.spec
+++ b/dlls/kernelbase/kernelbase.spec
@@ -1236,7 +1236,7 @@
 # @ stub QuirkIsEnabledForPackage4
 # @ stub QuirkIsEnabledForProcess
 @ stdcall RaiseException(long long long ptr)
-# @ stub RaiseFailFastException
+@ stdcall RaiseFailFastException(ptr ptr long)
 @ stdcall ReOpenFile(ptr long long long)
 @ stdcall ReadConsoleA(long ptr long ptr ptr)
 @ stdcall ReadConsoleInputA(long ptr long ptr)

-- 
2.35.1


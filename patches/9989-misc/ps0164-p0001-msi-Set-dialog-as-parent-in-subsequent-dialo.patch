From: Fabian Maurer <dark.shadow4@web.de>
Subject: [PATCH v2 1/3] msi: Set dialog as parent in subsequent dialog
Message-Id: <20210911201224.78002-1-dark.shadow4@web.de>
Date: Sat, 11 Sep 2021 22:12:22 +0200

Wine-Bug: https://bugs.winehq.org/show_bug.cgi?id=51576
Signed-off-by: Fabian Maurer <dark.shadow4@web.de>
---
 dlls/msi/dialog.c | 6 ++++--
 1 file changed, 4 insertions(+), 2 deletions(-)

diff --git a/dlls/msi/dialog.c b/dlls/msi/dialog.c
index 703f9d43957..6463c3062ac 100644
--- a/dlls/msi/dialog.c
+++ b/dlls/msi/dialog.c
@@ -3904,7 +3904,7 @@ static void process_pending_messages( HWND hdlg )
 static UINT dialog_run_message_loop( msi_dialog *dialog )
 {
     DWORD style;
-    HWND hwnd;
+    HWND hwnd, parent;

     if( uiThreadId != GetCurrentThreadId() )
         return SendMessageW( hMsiHiddenWindow, WM_MSI_DIALOG_CREATE, 0, (LPARAM) dialog );
@@ -3917,9 +3917,11 @@ static UINT dialog_run_message_loop( msi_dialog *dialog )
     if (dialog->parent == NULL && (dialog->attributes & msidbDialogAttributesMinimize))
         style |= WS_MINIMIZEBOX;

+    parent = dialog->parent ? dialog->parent->hwnd : 0;
+
     hwnd = CreateWindowW( L"MsiDialogCloseClass", dialog->name, style,
                      CW_USEDEFAULT, CW_USEDEFAULT, CW_USEDEFAULT, CW_USEDEFAULT,
-                     NULL, NULL, NULL, dialog );
+                     parent, NULL, NULL, dialog );
     if( !hwnd )
     {
         ERR("Failed to create dialog %s\n", debugstr_w( dialog->name ));
--
2.33.0




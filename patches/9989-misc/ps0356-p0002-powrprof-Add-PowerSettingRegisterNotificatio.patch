From: Torge Matthies <openglfreak@googlemail.com>
Subject: [PATCH 2/3] powrprof: Add PowerSettingRegisterNotification stub.
Message-Id: <20220227010235.276215-2-openglfreak@googlemail.com>
Date: Sun, 27 Feb 2022 02:02:34 +0100
In-Reply-To: <20220227010235.276215-1-openglfreak@googlemail.com>
References: <20220227010235.276215-1-openglfreak@googlemail.com>

Needed by old Special K versions according to
https://github.com/ValveSoftware/Proton/issues/5625.

Signed-off-by: Torge Matthies <openglfreak@googlemail.com>
---
 dlls/powrprof/powrprof.c    | 7 +++++++
 dlls/powrprof/powrprof.spec | 1 +
 include/powrprof.h          | 1 +
 3 files changed, 9 insertions(+)

diff --git a/dlls/powrprof/powrprof.c b/dlls/powrprof/powrprof.c
index 11111111111..11111111111 100644
--- a/dlls/powrprof/powrprof.c
+++ b/dlls/powrprof/powrprof.c
@@ -343,6 +343,13 @@ DWORD WINAPI PowerUnregisterSuspendResumeNotification(HPOWERNOTIFY handle)
     return ERROR_SUCCESS;
 }
 
+DWORD WINAPI PowerSettingRegisterNotification(const GUID *setting, DWORD flags, HANDLE recipient, PHPOWERNOTIFY handle)
+{
+    FIXME("(%s,0x%08lx,%p,%p) stub!\n", debugstr_guid(setting), flags, recipient, handle);
+    *handle = (PHPOWERNOTIFY)0xdeadbeef;
+    return ERROR_SUCCESS;
+}
+
 BOOL WINAPI DllMain(HINSTANCE hinstDLL, DWORD fdwReason, LPVOID lpvReserved)
 {
    switch(fdwReason) {
diff --git a/dlls/powrprof/powrprof.spec b/dlls/powrprof/powrprof.spec
index 11111111111..11111111111 100644
--- a/dlls/powrprof/powrprof.spec
+++ b/dlls/powrprof/powrprof.spec
@@ -19,6 +19,7 @@
 @ stdcall PowerReadFriendlyName (ptr ptr ptr ptr ptr ptr)
 @ stdcall PowerRegisterSuspendResumeNotification(long ptr ptr)
 @ stdcall PowerUnregisterSuspendResumeNotification(ptr)
+@ stdcall PowerSettingRegisterNotification(ptr long ptr ptr)
 @ stdcall ReadGlobalPwrPolicy (ptr)
 @ stdcall ReadProcessorPwrScheme (long ptr)
 @ stdcall ReadPwrScheme (long ptr)
diff --git a/include/powrprof.h b/include/powrprof.h
index 11111111111..11111111111 100644
--- a/include/powrprof.h
+++ b/include/powrprof.h
@@ -162,6 +162,7 @@ BOOLEAN WINAPI IsPwrSuspendAllowed(VOID);
 DWORD   WINAPI PowerEnumerate(HKEY, const GUID *, const GUID *, POWER_DATA_ACCESSOR, ULONG, UCHAR *, DWORD *);
 DWORD   WINAPI PowerRegisterSuspendResumeNotification(DWORD, HANDLE, PHPOWERNOTIFY);
 DWORD   WINAPI PowerUnregisterSuspendResumeNotification(HPOWERNOTIFY);
+DWORD   WINAPI PowerSettingRegisterNotification(const GUID *, DWORD, HANDLE, PHPOWERNOTIFY);
 BOOLEAN WINAPI ReadGlobalPwrPolicy(PGLOBAL_POWER_POLICY);
 BOOLEAN WINAPI ReadProcessorPwrScheme(UINT, PMACHINE_PROCESSOR_POWER_POLICY);
 BOOLEAN WINAPI ReadPwrScheme(UINT, PPOWER_POLICY);

-- 
2.35.1


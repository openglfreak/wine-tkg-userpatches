From a87ae4953064f58a4212d70760d24e84aad83ea1 Mon Sep 17 00:00:00 2001
From: Torge Matthies <tmatthies@codeweavers.com>
Date: Thu, 8 Dec 2022 05:44:26 +0100
Subject: [PATCH 4/5] ntdll: Make CDECL syscalls WINAPI instead.

---
 dlls/ntdll/ntdll.spec    | 6 +++---
 dlls/ntdll/unix/server.c | 6 +++---
 include/wine/server.h    | 6 +++---
 3 files changed, 9 insertions(+), 9 deletions(-)

diff --git a/dlls/ntdll/ntdll.spec b/dlls/ntdll/ntdll.spec
index 11111111111..11111111111 100644
--- a/dlls/ntdll/ntdll.spec
+++ b/dlls/ntdll/ntdll.spec
@@ -1690,9 +1690,9 @@
 # or 'wine_' (for user-visible functions) to avoid namespace conflicts.
 
 # Server interface
-@ cdecl -syscall -norelay wine_server_call(ptr)
-@ cdecl -syscall wine_server_fd_to_handle(long long long ptr)
-@ cdecl -syscall wine_server_handle_to_fd(long long ptr ptr)
+@ stdcall -syscall -norelay wine_server_call(ptr)
+@ stdcall -syscall wine_server_fd_to_handle(long long long ptr)
+@ stdcall -syscall wine_server_handle_to_fd(long long ptr ptr)
 
 # Unix interface
 @ stdcall __wine_unix_call(int64 long ptr)
diff --git a/dlls/ntdll/unix/server.c b/dlls/ntdll/unix/server.c
index 11111111111..11111111111 100644
--- a/dlls/ntdll/unix/server.c
+++ b/dlls/ntdll/unix/server.c
@@ -416,7 +416,7 @@ unsigned int server_call_unlocked( void *req_ptr )
  *
  * Perform a server call.
  */
-unsigned int CDECL wine_server_call( void *req_ptr )
+unsigned int SYSCALL wine_server_call( void *req_ptr )
 {
     struct __server_request_info * const req = req_ptr;
     sigset_t old_set;
@@ -1248,7 +1248,7 @@ done:
 /***********************************************************************
  *           wine_server_fd_to_handle
  */
-NTSTATUS CDECL wine_server_fd_to_handle( int fd, unsigned int access, unsigned int attributes, HANDLE *handle )
+NTSTATUS SYSCALL wine_server_fd_to_handle( int fd, unsigned int access, unsigned int attributes, HANDLE *handle )
 {
     unsigned int ret;
 
@@ -1272,7 +1272,7 @@ NTSTATUS CDECL wine_server_fd_to_handle( int fd, unsigned int access, unsigned i
  *
  * Retrieve the file descriptor corresponding to a file handle.
  */
-NTSTATUS CDECL wine_server_handle_to_fd( HANDLE handle, unsigned int access, int *unix_fd,
+NTSTATUS SYSCALL wine_server_handle_to_fd( HANDLE handle, unsigned int access, int *unix_fd,
                                          unsigned int *options )
 {
     int needs_close;
diff --git a/include/wine/server.h b/include/wine/server.h
index 11111111111..11111111111 100644
--- a/include/wine/server.h
+++ b/include/wine/server.h
@@ -49,9 +49,9 @@ struct __server_request_info
     struct __server_iovec data[__SERVER_MAX_DATA];  /* request variable size data */
 };
 
-extern unsigned int CDECL wine_server_call( void *req_ptr );
-extern NTSTATUS CDECL wine_server_fd_to_handle( int fd, unsigned int access, unsigned int attributes, HANDLE *handle );
-extern NTSTATUS CDECL wine_server_handle_to_fd( HANDLE handle, unsigned int access, int *unix_fd, unsigned int *options );
+extern unsigned int SYSCALL wine_server_call( void *req_ptr );
+extern NTSTATUS SYSCALL wine_server_fd_to_handle( int fd, unsigned int access, unsigned int attributes, HANDLE *handle );
+extern NTSTATUS SYSCALL wine_server_handle_to_fd( HANDLE handle, unsigned int access, int *unix_fd, unsigned int *options );
 
 /* do a server call and set the last error code */
 static inline unsigned int wine_server_call_err( void *req_ptr )
-- 
2.39.0


From: Akihiro Sagawa <sagawa.aki@gmail.com>
Subject: [PATCH 3/3] ws2_32: Disallow NULL in socket lookups.
Message-Id: <20210824215003.6AF2.375B48EC@gmail.com>
Date: Tue, 24 Aug 2021 21:50:39 +0900


NULL means an unused slot, not a valid socket.

Signed-off-by: Akihiro Sagawa <sagawa.aki@gmail.com>
---
 dlls/ws2_32/socket.c | 4 ++++
 1 file changed, 4 insertions(+)

diff --git a/dlls/ws2_32/socket.c b/dlls/ws2_32/socket.c
index f58f7cea5cc..bf87e7824e5 100644
--- a/dlls/ws2_32/socket.c
+++ b/dlls/ws2_32/socket.c
@@ -379,6 +379,8 @@ static BOOL socket_list_find( SOCKET socket )
 {
     unsigned int i;
 
+    if (!socket) return FALSE;
+
     EnterCriticalSection( &cs_socket_list );
     for (i = 0; i < socket_list_size; ++i)
     {
@@ -397,6 +399,8 @@ static BOOL socket_list_remove( SOCKET socket )
 {
     unsigned int i;
 
+    if (!socket) return FALSE;
+
     EnterCriticalSection(&cs_socket_list);
     for (i = 0; i < socket_list_size; ++i)
     {


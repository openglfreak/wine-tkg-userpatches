From: Ziqing Hui <zhui@codeweavers.com>
Subject: [PATCH 2/2] user32: Pass correct flags in CreateIconFromResource().
Message-Id: <20211209032056.1130920-2-zhui@codeweavers.com>
Date: Thu,  9 Dec 2021 11:20:56 +0800
In-Reply-To: <20211209032056.1130920-1-zhui@codeweavers.com>
References: <20211209032056.1130920-1-zhui@codeweavers.com>

Signed-off-by: Ziqing Hui <zhui@codeweavers.com>
---
 dlls/user32/cursoricon.c       | 2 +-
 dlls/user32/tests/cursoricon.c | 8 --------
 2 files changed, 1 insertion(+), 9 deletions(-)

diff --git a/dlls/user32/cursoricon.c b/dlls/user32/cursoricon.c
index f107255c8c0..827db302a30 100644
--- a/dlls/user32/cursoricon.c
+++ b/dlls/user32/cursoricon.c
@@ -1592,7 +1592,7 @@ HICON WINAPI CreateIconFromResourceEx( LPBYTE bits, UINT cbSize,
 HICON WINAPI CreateIconFromResource( LPBYTE bits, UINT cbSize,
                                            BOOL bIcon, DWORD dwVersion)
 {
-    return CreateIconFromResourceEx( bits, cbSize, bIcon, dwVersion, 0,0,0);
+    return CreateIconFromResourceEx( bits, cbSize, bIcon, dwVersion, 0, 0, LR_DEFAULTSIZE | LR_SHARED );
 }
 
 
diff --git a/dlls/user32/tests/cursoricon.c b/dlls/user32/tests/cursoricon.c
index d73650e08f7..1bbe2591d59 100644
--- a/dlls/user32/tests/cursoricon.c
+++ b/dlls/user32/tests/cursoricon.c
@@ -1595,10 +1595,8 @@ static void test_CreateIconFromResource(void)
     /* Test the icon information. */
     SetLastError(0xdeadbeef);
     ret = GetIconInfo(handle, &icon_info);
-    todo_wine
     ok(ret, "GetIconInfo() failed.\n");
     error = GetLastError();
-    todo_wine
     ok(error == 0xdeadbeef, "Last error: %u\n", error);
 
     if (ret)
@@ -1616,14 +1614,10 @@ static void test_CreateIconFromResource(void)
         ICONINFOEXA infoex;
         infoex.cbSize = sizeof(infoex);
         ret = pGetIconInfoExA( handle, &infoex );
-        todo_wine
         ok( ret, "GetIconInfoEx failed err %d\n", GetLastError() );
-        if (ret)
-        {
         ok( infoex.wResID == 0, "GetIconInfoEx wrong resid %x\n", infoex.wResID );
         ok( infoex.szModName[0] == 0, "GetIconInfoEx wrong module %s\n", infoex.szModName );
         ok( infoex.szResName[0] == 0, "GetIconInfoEx wrong name %s\n", infoex.szResName );
-        }
     }
 
     /* Test creating an icon. */
@@ -1637,10 +1631,8 @@ static void test_CreateIconFromResource(void)
     /* Test the icon information. */
     SetLastError(0xdeadbeef);
     ret = GetIconInfo(handle, &icon_info);
-    todo_wine
     ok(ret, "GetIconInfo() failed.\n");
     error = GetLastError();
-    todo_wine
     ok(error == 0xdeadbeef, "Last error: %u\n", error);
 
     if (ret)

-- 
2.25.1


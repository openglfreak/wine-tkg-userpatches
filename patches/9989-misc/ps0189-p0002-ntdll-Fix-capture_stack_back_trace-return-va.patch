From: Paul Gofman <pgofman@codeweavers.com>
Subject: [PATCH v2 2/4] ntdll: Fix capture_stack_back_trace() return value on error path for x86_64.
Message-Id: <20211028160211.146519-2-pgofman@codeweavers.com>
Date: Thu, 28 Oct 2021 19:02:09 +0300
In-Reply-To: <20211028160211.146519-1-pgofman@codeweavers.com>
References: <20211028160211.146519-1-pgofman@codeweavers.com>

Signed-off-by: Paul Gofman <pgofman@codeweavers.com>
---
 dlls/ntdll/signal_x86_64.c | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

diff --git a/dlls/ntdll/signal_x86_64.c b/dlls/ntdll/signal_x86_64.c
index f401bc8b477..57c7f81f9ea 100644
--- a/dlls/ntdll/signal_x86_64.c
+++ b/dlls/ntdll/signal_x86_64.c
@@ -1538,7 +1538,7 @@ USHORT WINAPI RtlCaptureStackBackTrace( ULONG skip, ULONG count, PVOID *buffer,
     for (i = 0; i < skip + count; i++)
     {
         status = virtual_unwind( UNW_FLAG_NHANDLER, &dispatch, &context );
-        if (status != STATUS_SUCCESS) return i;
+        if (status != STATUS_SUCCESS) return num_entries;
 
         if (!dispatch.EstablisherFrame) break;
 

-- 
2.31.1


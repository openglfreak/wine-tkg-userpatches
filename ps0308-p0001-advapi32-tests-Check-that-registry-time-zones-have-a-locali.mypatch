From: Giovanni Mascellani <gmascellani@codeweavers.com>
Subject: [PATCH 1/4] advapi32/tests: Check that registry time zones have a localized display name.
Message-Id: <20210309094729.1833042-1-gmascellani@codeweavers.com>
Date: Tue,  9 Mar 2021 10:47:26 +0100

Signed-off-by: Giovanni Mascellani <gmascellani@codeweavers.com>
---
 dlls/advapi32/tests/registry.c | 11 +++++++++++
 1 file changed, 11 insertions(+)

diff --git a/dlls/advapi32/tests/registry.c b/dlls/advapi32/tests/registry.c
index dfadd13ea8c..718cc7769a2 100644
--- a/dlls/advapi32/tests/registry.c
+++ b/dlls/advapi32/tests/registry.c
@@ -4023,14 +4023,17 @@ static void test_EnumDynamicTimeZoneInformation(void)
     HKEY key, subkey;
     WCHAR name[32];
     WCHAR keyname[128];
+    WCHAR displayname[128];
     WCHAR sysdir[MAX_PATH];
     DWORD index, ret, gle, size;
     DYNAMIC_TIME_ZONE_INFORMATION bogus_dtzi, dtzi;
     static const WCHAR stdW[] = {'S','t','d',0};
     static const WCHAR dltW[] = {'D','l','t',0};
     static const WCHAR tziW[] = {'T','Z','I',0};
+    static const WCHAR displayW[] = {'D','i','s','p','l','a','y',0};
     static const WCHAR mui_stdW[] = {'M','U','I','_','S','t','d',0};
     static const WCHAR mui_dltW[] = {'M','U','I','_','D','l','t',0};
+    static const WCHAR mui_displayW[] = {'M','U','I','_','D','i','s','p','l','a','y',0};
     struct tz_reg_data
     {
         LONG bias;
@@ -4109,6 +4112,14 @@ static void test_EnumDynamicTimeZoneInformation(void)
             ok(status == ERROR_SUCCESS, "status %d name %s\n", status, wine_dbgstr_w(name));
             ok(!memcmp(&dtzi.DaylightName, name, size),
                 "expected %s, got %s\n", wine_dbgstr_w(name), wine_dbgstr_w(dtzi.DaylightName));
+
+            size = sizeof(displayname);
+            memset(displayname, 0, sizeof(displayname));
+            if (pRegLoadMUIStringW)
+                status = pRegLoadMUIStringW(subkey, mui_displayW, displayname, size, &size, 0, sysdir);
+            else
+                status = pRegGetValueW(subkey, NULL, displayW, RRF_RT_REG_SZ, NULL, displayname, &size);
+            todo_wine ok(status == ERROR_SUCCESS, "status %d displayname %s\n", status, wine_dbgstr_w(displayname));
         }
         else
         {

-- 
2.30.1

